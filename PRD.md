# 阅迹（ReadTrip）产品需求文档（PRD）

**版本**: v1.0  
**最后更新**: 2026-02-09  
**产品经理**: [待填写]  
**技术负责人**: [待填写]

---

## 1. 产品概述

### 1.1 产品定位

**阅迹（ReadTrip）** 是一款面向阅读爱好者的**阅读足迹可视化应用**，通过记录用户阅读的书籍，在世界地图上按**作者国籍**展示阅读足迹，帮助用户以地理视角回顾和分享自己的阅读历程。

### 1.2 产品愿景

让每一次阅读都成为一次"旅行"，让每一本书都点亮一个国家的"足迹"。

### 1.3 核心价值

- **可视化阅读历程**：将抽象的阅读记录转化为直观的地图展示
- **地理文化探索**：通过作者国籍了解不同国家和地区的文学作品
- **个人阅读档案**：系统化记录和管理个人阅读历史
- **社交分享**：支持导出精美的阅读地图，便于分享

---

## 2. 目标用户

### 2.1 主要用户群体

1. **阅读爱好者**
   - 喜欢记录阅读历史的用户
   - 希望通过可视化方式回顾阅读历程
   - 对世界文学和不同文化感兴趣

2. **读书会/阅读社群**
   - 需要批量导入和管理阅读记录
   - 希望展示集体阅读足迹
   - 需要导出功能用于分享和展示

3. **教育工作者**
   - 记录学生阅读情况
   - 展示阅读覆盖的国家和地区
   - 用于教学和评估

### 2.2 用户画像

**典型用户：小A**
- 年龄：25-35岁
- 职业：白领/学生/教师
- 阅读习惯：每月阅读2-5本书，喜欢记录和分享
- 痛点：传统阅读记录方式缺乏视觉冲击力，难以展示阅读的广度
- 需求：希望有一个工具能够可视化展示自己的阅读足迹

---

## 3. 核心功能

### 3.1 功能架构图

```
阅迹（ReadTrip）
├── 书籍录入
│   ├── 单本录入（AI匹配）
│   └── Excel批量导入
├── 地图可视化
│   ├── 世界地图展示
│   ├── 国家点亮（按作者国籍）
│   ├── 书籍标记与聚合
│   └── 交互式探索
├── 阅读记录管理
│   ├── 记录列表
│   ├── 书籍详情
│   ├── 编辑与删除
│   └── 批量操作
├── 数据统计
│   ├── 阅读总数
│   ├── 国家覆盖数
│   └── 阅读趋势（未来）
└── 导出与分享
    ├── 地图截图导出
    └── 阅读记录导出
```

---

## 4. 功能详细说明

### 4.1 书籍录入

#### 4.1.1 单本录入（AI匹配）

**功能描述**：用户输入书名，系统通过AI自动匹配书籍信息。

**输入**：
- 书名（必填）

**AI匹配返回**：
- 书名（原文）
- 作者名
- 作者国籍（国家名 + ISO代码）
- 书籍类型（小说、历史、哲学、科幻、传记等）
- 书籍简介（可选）
- 封面URL（从Open Library或Google Books获取）

**匹配规则**：
- **重要**：`country` 和 `countryCode` **必须且仅表示原作者国籍**，即作者本人所属/所属国
- **不是**书籍故事发生地、主题相关国家或出版社所在国
- 示例：《看不见的中东》作者为中国人 → country: 中国，countryCode: CN
- 示例：《和语言漫步的日记》作者为日本人 → country: 日本，countryCode: JP

**用户操作**：
1. 点击"记录足迹"按钮
2. 输入书名
3. 点击匹配按钮（✨）
4. 查看AI匹配结果
5. 可编辑匹配结果（书名、作者、类型、作者国籍）
6. 填写阅读时间（开始日期、结束日期，可选）
7. 填写短评（可选，最多100字）
8. 保存记录

**技术实现**：
- 前端调用 Supabase Edge Function `match-book`
- Edge Function 调用 AI Gateway（Google Gemini 3 Flash）
- 封面优先从本地图片库匹配，其次从Open Library/Google Books获取

#### 4.1.2 Excel批量导入

**功能描述**：支持通过Excel文件批量导入阅读记录。

**Excel格式要求**：
- 支持的列名（中英文均可）：
  - `书名/title` - 必填
  - `作者/author` - 可选（如缺失将使用AI匹配）
  - `作者国籍` - 可选（地图按作者国籍展示，如缺失将使用AI匹配）
  - `类型/genre` - 可选
  - `国家/country` - 可选，指作者国籍（如缺失将使用AI匹配）
  - `国家代码/countryCode` - 可选（如缺失将按作者国籍自动查找）
  - `开始日期/startDate` - 可选（格式：YYYY-MM-DD）
  - `结束日期/endDate` 或 `读完日期` - 可选（格式：YYYY-MM-DD）
  - `短评/review` 或 `一句话总结` - 可选
  - `封面/coverUrl` - 可选（图片URL）

**导入流程**：
1. 用户上传Excel文件（.xlsx, .xls）
2. 系统解析Excel，提取数据
3. 对于信息不完整的记录，调用AI匹配补充
4. 验证数据有效性（必须有书名和作者国籍代码）
5. 批量添加到阅读记录
6. 显示导入结果（成功/失败数量）

**优先级规则**：
- Excel中的"作者国籍"字段优先于AI匹配结果
- 如果Excel中有国家名称但没有代码，系统自动查找对应的ISO代码
- 封面优先使用Excel中的URL，其次使用AI匹配结果，最后尝试本地图片库

---

### 4.2 地图可视化

#### 4.2.1 世界地图展示

**功能描述**：使用SVG世界地图展示阅读足迹。

**地图特性**：
- 使用 Natural Earth 110m 分辨率地图数据
- 支持缩放和平移（react-simple-maps）
- 响应式设计，适配不同屏幕尺寸
- 支持多种视觉风格（温暖、黑金、复古羊皮）

**国家状态**：
- **已访问**：用户有阅读过该国家作者的作品（高亮显示）
- **未访问**：用户尚未阅读过该国家作者的作品（灰色显示）
- **悬停效果**：鼠标悬停时显示国家名称和书籍数量

#### 4.2.2 书籍标记与聚合

**功能描述**：在地图上标记有书籍的国家，并显示书籍信息。

**标记方式**：
- 每个有书籍的国家在地图上显示一个标记点
- 标记点位置：使用预设的国家中心坐标（`COUNTRY_CENTERS`）
- 标记点样式：
  - 显示国家国旗emoji
  - 显示国家名称（中文）
  - 显示书籍数量（如：3本）
  - 支持展开/聚合视图切换

**书籍展示**：
- **聚合视图**：只显示国家标记和数量
- **展开视图**：显示该国家的所有书籍封面缩略图
- 书籍封面排列：围绕国家中心点呈圆形或网格排列
- 点击书籍封面：打开书籍详情卡片

**交互**：
- 点击国家标记：打开该国家的阅读记录列表
- 点击书籍封面：打开书籍详情卡片
- 悬停国家：高亮显示，显示书籍预览

#### 4.2.3 地图交互

**功能描述**：提供丰富的地图交互功能。

**交互操作**：
- **缩放**：鼠标滚轮或触摸手势
- **平移**：拖拽地图
- **点击国家**：筛选并显示该国家的书籍列表
- **点击书籍**：查看书籍详情
- **重置视图**：返回初始缩放和平移状态

---

### 4.3 阅读记录管理

#### 4.3.1 记录列表

**功能描述**：以列表形式展示所有阅读记录。

**列表特性**：
- 按国家分组显示（可选）
- 支持按国家筛选
- 显示书籍基本信息：封面、书名、作者、类型、作者国籍、阅读时间
- 支持删除操作
- 响应式设计，适配移动端

**排序方式**：
- 默认：按添加时间倒序（最新在前）
- 可选：按国家分组，国家内按时间倒序

#### 4.3.2 书籍详情

**功能描述**：展示单本书籍的详细信息。

**详情内容**：
- 书籍封面（大图）
- 书名
- 作者
- 作者国籍（国旗 + 国家名）
- 书籍类型
- 阅读时间（开始日期、结束日期）
- 短评
- 操作按钮：编辑、删除

**交互**：
- 从地图点击书籍封面打开
- 从列表点击书籍项打开
- 支持关闭操作

#### 4.3.3 编辑与删除

**功能描述**：支持修改和删除阅读记录。

**编辑功能**：
- 在书籍详情卡片中点击编辑
- 可修改：书名、作者、类型、作者国籍、阅读时间、短评
- 保存后更新记录

**删除功能**：
- 在列表或详情中点击删除
- 需要确认操作（防止误删）
- 删除后从地图和列表中移除

**批量操作**（未来功能）：
- 批量删除
- 批量编辑作者国籍
- 批量更新封面

---

### 4.4 数据统计

#### 4.4.1 统计指标

**当前统计**：
- **已阅读书籍总数**：所有阅读记录的数量
- **已点亮国家数**：有阅读记录的不同国家数量（按作者国籍统计）

**显示位置**：
- 头部导航栏（桌面端）
- 底部浮动卡片（移动端）

**未来扩展**：
- 阅读趋势图表（按月份/年份）
- 国家分布饼图
- 类型分布统计
- 阅读时长统计

---

### 4.5 导出与分享

#### 4.5.1 地图截图导出

**功能描述**：将当前地图视图导出为图片。

**导出内容**：
- 世界地图（当前视图）
- 已访问国家标记
- 书籍封面（展开视图时）
- 统计信息（书籍总数、国家数）
- 产品Logo和名称

**导出格式**：
- PNG图片
- 分辨率：1200x800px（可调整）

**使用场景**：
- 社交媒体分享
- 个人博客/网站展示
- 读书会活动展示
- 年度阅读总结

#### 4.5.2 阅读记录导出

**功能描述**：导出阅读记录为结构化数据。

**导出格式**（未来）：
- Excel文件（.xlsx）
- JSON文件
- CSV文件

**导出内容**：
- 所有阅读记录字段
- 统计摘要

---

### 4.6 视觉风格

#### 4.6.1 风格主题

**当前支持的主题**：
1. **温暖（Warm）**
   - 暖色调配色
   - 适合日常使用
   - 默认主题

2. **黑金（Dark Gold）**
   - 深色背景 + 金色点缀
   - 高端、优雅
   - 适合夜间使用

3. **复古羊皮（Parchment）**
   - 羊皮纸质感
   - 复古、文艺
   - 适合展示和分享

**切换方式**：
- 左下角风格切换按钮
- 下拉菜单选择主题
- 实时切换，无需刷新

**未来扩展**：
- 用户自定义主题
- 更多预设主题
- 主题预览功能

---

## 5. 技术架构

### 5.1 技术栈

**前端**：
- React 18.3
- TypeScript
- Vite（构建工具）
- Tailwind CSS（样式）
- Framer Motion（动画）
- React Simple Maps（地图）
- shadcn/ui（UI组件库）
- Sonner（Toast通知）

**后端/服务**：
- Supabase（数据库 + Edge Functions）
- Supabase Edge Functions（Deno运行时）
- AI Gateway（Lovable AI Gateway）
- Google Gemini 3 Flash（AI模型）

**数据存储**：
- Supabase PostgreSQL（阅读记录）
- LocalStorage（用户偏好设置）

**第三方API**：
- Open Library API（书籍封面）
- Google Books API（书籍封面）

### 5.2 数据模型

#### 5.2.1 BookInfo（书籍信息）

```typescript
interface BookInfo {
  id: string;                    // UUID
  title: string;                 // 书名
  author: string;                // 作者
  coverUrl?: string;            // 封面URL（可选）
  genre?: string;               // 类型（可选）
  country: string;              // 作者国籍（国家名，中文）
  countryCode: string;          // 作者国籍（ISO 3166-1 alpha-2代码）
}
```

#### 5.2.2 ReadingRecord（阅读记录）

```typescript
interface ReadingRecord {
  id: string;                    // UUID
  book: BookInfo;               // 书籍信息
  startDate?: string;           // 开始日期（YYYY-MM-DD，可选）
  endDate?: string;             // 结束日期（YYYY-MM-DD，可选）
  review?: string;              // 短评（可选，最多100字）
  createdAt: string;            // 创建时间（ISO 8601）
}
```

### 5.3 核心API

#### 5.3.1 match-book（AI匹配）

**端点**：`/functions/v1/match-book`

**请求**：
```json
{
  "bookTitle": "书名"
}
```

**响应**：
```json
{
  "success": true,
  "book": {
    "title": "书名",
    "author": "作者",
    "genre": "类型",
    "country": "作者国籍（中文）",
    "countryCode": "CN",
    "coverUrl": "封面URL",
    "description": "简介"
  }
}
```

**错误响应**：
```json
{
  "error": "错误信息"
}
```

---

## 6. 用户体验设计

### 6.1 界面布局

**桌面端布局**：
- **顶部导航栏**：Logo、统计信息、操作菜单
- **地图区域**：占据主要屏幕空间
- **左下角**：风格切换、更新封面、导出按钮
- **底部中央**：记录足迹按钮（主操作）

**移动端布局**：
- **顶部导航栏**：Logo、操作菜单（简化）
- **地图区域**：全屏显示
- **底部浮动卡片**：统计信息
- **底部中央**：记录足迹按钮

### 6.2 交互流程

#### 6.2.1 添加书籍流程

```
用户点击"记录足迹"
    ↓
输入书名
    ↓
点击匹配按钮
    ↓
AI匹配中（加载状态）
    ↓
显示匹配结果
    ↓
[可选] 编辑信息
    ↓
[可选] 填写阅读时间和短评
    ↓
保存记录
    ↓
地图自动更新，显示新书籍
```

#### 6.2.2 查看书籍流程

```
用户点击地图上的国家/书籍
    ↓
显示该国家的书籍列表
    ↓
用户点击某本书
    ↓
显示书籍详情卡片
    ↓
[可选] 编辑或删除
```

### 6.3 空状态设计

**首次使用**：
- 显示引导文案："开始你的阅读之旅"
- 显示说明："记录每一本书，点亮你走过的世界"
- 突出"记录第一本书"按钮

**无数据时**：
- 地图显示为灰色（未访问状态）
- 统计信息显示为0
- 操作按钮可用但提示需要先添加数据

### 6.4 加载状态

**AI匹配中**：
- 显示加载动画
- 提示："正在匹配书籍信息..."
- 禁用操作按钮

**批量导入中**：
- 显示进度提示
- 显示已处理数量
- 完成后显示成功/失败统计

---

## 7. 非功能性需求

### 7.1 性能要求

- **页面加载时间**：首屏加载 < 2秒
- **AI匹配响应时间**：< 5秒（平均）
- **地图渲染性能**：60fps流畅交互
- **批量导入性能**：支持100+条记录批量导入

### 7.2 兼容性要求

**浏览器支持**：
- Chrome/Edge（最新2个版本）
- Firefox（最新2个版本）
- Safari（最新2个版本）
- 移动端浏览器（iOS Safari、Chrome Mobile）

**屏幕尺寸**：
- 桌面端：1920x1080及以上
- 平板：768px - 1024px
- 移动端：375px - 768px

### 7.3 可访问性

- 支持键盘导航
- 支持屏幕阅读器（ARIA标签）
- 颜色对比度符合WCAG 2.1 AA标准
- 提供文字替代方案（图标+文字）

### 7.4 安全性

- 数据存储在用户本地（Supabase用户隔离）
- API调用使用HTTPS
- 输入验证和XSS防护
- 敏感操作需要确认（删除等）

---

## 8. 数据与配置

### 8.1 国家数据

**国家代码映射**：
- 使用ISO 3166-1 alpha-2标准
- 支持200+个国家/地区
- 中英文国家名称映射（`COUNTRY_NAMES`）

**国家中心坐标**：
- 预设主要国家的中心坐标（`COUNTRY_CENTERS`）
- 用于在地图上标记书籍位置
- 格式：[经度, 纬度]

### 8.2 本地封面库

**功能**：
- 预设常用书籍的封面图片
- 存储在 `public/book-covers/` 目录
- 优先使用本地封面，减少API调用

**匹配规则**：
- 按书名精确匹配
- 支持部分书名匹配（未来）

---

## 9. 未来规划

### 9.1 短期规划（3个月内）

1. **用户账户系统**
   - 用户注册/登录
   - 数据云端同步
   - 多设备访问

2. **阅读统计增强**
   - 阅读趋势图表
   - 类型分布统计
   - 国家分布可视化

3. **导出功能增强**
   - Excel导出
   - JSON/CSV导出
   - 自定义导出模板

4. **批量操作**
   - 批量编辑
   - 批量删除
   - 批量更新封面

### 9.2 中期规划（3-6个月）

1. **社交功能**
   - 阅读足迹分享
   - 好友关注
   - 阅读排行榜

2. **推荐系统**
   - 基于阅读历史的推荐
   - 国家/类型推荐
   - 相似用户推荐

3. **阅读挑战**
   - 年度阅读目标
   - 国家覆盖挑战
   - 类型多样化挑战

4. **数据导入增强**
   - 支持更多格式（CSV、JSON）
   - 从其他阅读应用导入（Goodreads、豆瓣等）

### 9.3 长期规划（6个月以上）

1. **移动应用**
   - iOS/Android原生应用
   - 离线功能
   - 推送通知

2. **AI功能增强**
   - 智能阅读建议
   - 自动生成阅读报告
   - 阅读习惯分析

3. **社区功能**
   - 读书会/小组
   - 书评和讨论
   - 阅读活动

4. **商业化**
   - 高级功能（数据分析、无限导出等）
   - 企业版（教育机构、图书馆）
   - API开放平台

---

## 10. 风险评估

### 10.1 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| AI匹配准确率低 | 高 | 中 | 提供手动编辑功能，持续优化prompt |
| 第三方API不稳定 | 中 | 中 | 使用多个数据源，本地封面库作为备选 |
| 地图性能问题 | 中 | 低 | 使用成熟的库，优化渲染逻辑 |
| 数据丢失 | 高 | 低 | 定期备份，支持导出功能 |

### 10.2 产品风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| 用户需求不明确 | 中 | 中 | 用户调研，快速迭代 |
| 竞品冲击 | 中 | 中 | 差异化定位，专注核心功能 |
| 用户留存率低 | 高 | 中 | 增强社交功能，提供价值 |

---

## 11. 成功指标（KPI）

### 11.1 用户指标

- **日活跃用户（DAU）**
- **月活跃用户（MAU）**
- **用户留存率**（次日、7日、30日）
- **平均使用时长**

### 11.2 功能指标

- **书籍录入数量**（日均、月均）
- **AI匹配成功率**（>90%）
- **地图交互次数**
- **导出功能使用率**

### 11.3 质量指标

- **页面加载时间**（<2秒）
- **AI匹配响应时间**（<5秒）
- **错误率**（<1%）
- **用户满意度**（NPS > 50）

---

## 12. 附录

### 12.1 术语表

- **作者国籍**：书籍原作者所属的国家/地区（ISO 3166-1 alpha-2代码）
- **阅读记录**：用户记录的一本书的阅读信息（包含书籍信息、阅读时间、短评等）
- **国家点亮**：在地图上标记用户已阅读过该国家作者的作品
- **AI匹配**：通过AI自动识别书名并返回书籍详细信息

### 12.2 参考文档

- [ISO 3166-1 国家代码标准](https://www.iso.org/iso-3166-country-codes.html)
- [React Simple Maps 文档](https://www.react-simple-maps.io/)
- [Supabase 文档](https://supabase.com/docs)
- [Google Gemini API 文档](https://ai.google.dev/docs)

### 12.3 更新日志

**v1.0 (2026-02-09)**
- 初始PRD版本
- 定义核心功能和需求
- 明确作者国籍匹配规则

---

**文档结束**

如有疑问或建议，请联系产品团队。
